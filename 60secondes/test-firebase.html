<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>Test de Configuration Firebase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }

        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .success {
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            color: #00ff00;
        }

        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0000;
            color: #ff6666;
        }

        .pending {
            background: rgba(255, 165, 0, 0.2);
            border: 2px solid #ffa500;
            color: #ffa500;
        }

        h1 {
            color: #00ff00;
        }

        pre {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        .info {
            background: rgba(0, 150, 255, 0.1);
            border: 1px solid rgba(0, 150, 255, 0.3);
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <h1>üî• Test de Configuration Firebase</h1>

    <div class="info">
        <strong>Ce fichier teste la connexion √† Firebase.</strong><br>
        Ouvrez la console du navigateur (F12) pour voir les d√©tails.
    </div>

    <h2>√âtat de la connexion :</h2>
    <div id="status"
         class="status pending">‚è≥ Test en cours...</div>

    <h2>Configuration d√©tect√©e :</h2>
    <pre id="config">Chargement...</pre>

    <h2>Test de lecture de la base de donn√©es :</h2>
    <div id="dbTest"
         class="status pending">‚è≥ Test en cours...</div>

    <h2>Donn√©es du jeu :</h2>
    <pre id="gameData">Chargement...</pre>

    <h2>Configuration du jeu :</h2>
    <pre id="configData">Chargement...</pre>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        console.log('=== Test de Configuration Firebase ===');

        // Afficher la configuration (sans les cl√©s sensibles)
        const configDisplay = {
            authDomain: firebaseConfig.authDomain,
            databaseURL: firebaseConfig.databaseURL,
            projectId: firebaseConfig.projectId,
            apiKey: firebaseConfig.apiKey ? '‚úì Pr√©sente' : '‚úó Manquante'
        };
        document.getElementById('config').textContent = JSON.stringify(configDisplay, null, 2);

        try {
            // Initialiser Firebase
            firebase.initializeApp(firebaseConfig);
            console.log('‚úì Firebase initialis√© avec succ√®s');

            const database = firebase.database();
            const gameRef = database.ref('game');
            const configRef = database.ref('config');

            // Test de connexion
            const connectedRef = database.ref('.info/connected');
            connectedRef.on('value', (snap) => {
                if (snap.val() === true) {
                    console.log('‚úì Connect√© √† Firebase');
                    document.getElementById('status').className = 'status success';
                    document.getElementById('status').textContent = '‚úì Connect√© √† Firebase avec succ√®s !';
                } else {
                    console.log('‚úó D√©connect√© de Firebase');
                    document.getElementById('status').className = 'status error';
                    document.getElementById('status').textContent = '‚úó D√©connect√© de Firebase';
                }
            });

            // Test de lecture des donn√©es du jeu
            gameRef.once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    console.log('‚úì Lecture des donn√©es du jeu r√©ussie', data);
                    document.getElementById('dbTest').className = 'status success';
                    document.getElementById('dbTest').textContent = '‚úì Lecture de la base de donn√©es r√©ussie !';
                    document.getElementById('gameData').textContent = data ? JSON.stringify(data, null, 2) : 'Aucune donn√©e (c\'est normal au premier lancement)';
                })
                .catch((error) => {
                    console.error('‚úó Erreur lors de la lecture des donn√©es du jeu', error);
                    document.getElementById('dbTest').className = 'status error';
                    document.getElementById('dbTest').textContent = '‚úó Erreur : ' + error.message;
                    document.getElementById('gameData').textContent = 'Erreur : ' + error.message;
                });

            // Test de lecture de la configuration
            configRef.once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    console.log('‚úì Lecture de la configuration r√©ussie', data);
                    document.getElementById('configData').textContent = data ? JSON.stringify(data, null, 2) : 'Aucune configuration (cr√©ez-la depuis le dashboard)';
                })
                .catch((error) => {
                    console.error('‚úó Erreur lors de la lecture de la configuration', error);
                    document.getElementById('configData').textContent = 'Erreur : ' + error.message;
                });

        } catch (error) {
            console.error('‚úó Erreur lors de l\'initialisation de Firebase', error);
            document.getElementById('status').className = 'status error';
            document.getElementById('status').textContent = '‚úó Erreur : ' + error.message;
            document.getElementById('config').textContent = 'Erreur : ' + error.message;
            document.getElementById('dbTest').className = 'status error';
            document.getElementById('dbTest').textContent = '‚úó Impossible de tester la base de donn√©es';
        }
    </script>
</body>

</html>